<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pakistan News</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <!-- Leaflet CSS for maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0%' stop-color='%23ff5733'/%3E%3Cstop offset='100%' stop-color='%23ffc300'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath fill='url(%23g)' d='M572.52 241.4C518.94 135.5 407.45 64 288 64S57.06 135.5 3.48 241.4a48.44 48.44 0 000 29.2C57.06 376.5 168.55 448 288 448s230.94-71.5 284.52-177.4a48.44 48.44 0 000-29.2zM288 400a112 112 0 11112-112 112.14 112.14 0 01-112 112zm0-176a64 64 0 1064 64 64 64 0 00-64-64z'/%3E%3C/svg%3E" type="image/svg+xml">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f7fa;
      color: #2c3e50;
      transition: background 0.4s, color 0.4s;
    }

    body.dark {
      background: #121212;
      color: #e0e0e0;
    }

    header {
      background: #1b2631;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 15px;
      flex-wrap: wrap;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    header img { width: 250px; height: 90px; margin-right: 50px; }
    .header-text h1 { margin: 0; font-size: 28px; }
    .header-text h2 { margin: 5px 0; color: #f0c419; font-weight: 400; font-size: 18px; }

    nav {
      background: #2c3e50;
      display: flex;
      justify-content: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .nav-links {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    nav button {
      background: none;
      border: none;
      color: white;
      padding: 15px 20px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    nav button:hover { background: #34495e; }

    .hamburger {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 10px 15px;
    }

    main { padding: 30px; }
    
    .topbar-container {
        position: sticky;
        top: 0;
        z-index: 10;
        display: flex;
        align-items: center;
        margin-top: -20px;
    }

    .scroll-btn {
        display: none;
        background: #2c3e50;
        color: white;
        border: none;
        padding: 0 12px;
        font-size: 20px;
        cursor: pointer;
        height: 57px;
        z-index: 12;
        transition: background 0.3s;
    }
    .scroll-btn:hover { background: #34495e; }
    .scroll-btn.left { border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
    .scroll-btn.right { border-top-right-radius: 8px; border-bottom-right-radius: 8px; }

    .topbar {
      flex-grow: 1;
      display: flex;
      overflow-x: auto;
      padding: 10px;
      background: #ecf0f1;
      gap: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      scroll-behavior: smooth;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .topbar::-webkit-scrollbar { display: none; }

    .topbar button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      white-space: nowrap;
      cursor: pointer;
      transition: transform 0.3s, background 0.3s;
    }
    .topbar button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
    }
    .topbar button.active {
     background: #e74c3c;
     transform: translateY(-2px);
     box-shadow: 0 6px 20px rgba(231, 76, 60, 0.6);
    }

    .section, .section1 { display: none; animation: fadeIn 0.5s ease-in; }
    .active, .active1 { display: block; }
    .section1 { text-align: center; padding: 0px; }
    .section1 h2, .section h2 { font-size: 28px; color: #34495e; margin-bottom: 30px; text-align: center; }
    .section1 p { font-size: 18px; color: #6c7a89; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    #news-container { display: flex; flex-direction: column; gap: 24px; padding-top: 20px; }

    .news-item {
      background: #fff;
      border-radius: 10px;
      box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      display: flex;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .news-item:hover { transform: translateY(-4px); box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3); }
    .news-image { flex: 0 0 200px; height: 140px; object-fit: cover; width: 100%; }
    .news-content { padding: 20px; display: flex; flex-direction: column; flex: 1; }
    .news-title { font-size: 20px; margin: 0 0 8px; color: #2c3e50; }
    .news-title a { text-decoration: none; color: inherit; }
    .news-title a:hover { color: #2980b9; }
    .meta { font-size: 12px; color: #6c7a89; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
    .description-short, .description-full { font-size: 14px; line-height: 1.5; color: #34495e; margin-bottom: 16px; }
    .description-full { display: none; }
    .news-footer { margin-top: auto; display: flex; justify-content: flex-start; align-items: center; gap: 10px; flex-wrap: wrap; }
    .news-footer button, .news-footer a { font-size: 14px; padding: 8px 14px; border-radius: 6px; text-decoration: none; transition: background 0.3s; border: none; cursor: pointer; }
    .news-footer button.read-more { background: #2980b9; color: #fff; }
    .news-footer button.read-more:hover { background: #1c5980; }
    .news-footer a.share-btn { background: #25d366; color: #fff; }
    .news-footer a.share-btn:hover { background: #1aae5d; }
    .news-footer a.source-btn { background: #7f8c8d; color: #fff; }
    .news-footer a.source-btn:hover { background: #606f73; }

    #twitter-accounts { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
    .twitter-link-item {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      text-decoration: none;
      color: #1DA1F2;
      font-weight: bold;
      font-size: 18px;
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .twitter-link-item:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(29, 161, 242, 0.3); }
    .twitter-link-item .fab.fa-twitter { font-size: 28px; }

    .loader { text-align: center; padding: 50px; }
    .spinner { width: 40px; height: 40px; border: 4px solid #ccc; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* --- GPS Section Styles --- */
    #gps h2 {
      position: relative;
    }
    #gps h2::after {
      content: '';
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: #3498db;
      border-radius: 2px;
    }
    #gps-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin-bottom: 40px;
    }
    .converter-box {
      background: #ffffff;
      padding: 30px;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 8px 25px rgba(0,0,0,0.07);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .converter-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.1);
    }
    .converter-box h3 {
      margin-top: 0;
      margin-bottom: 25px;
      color: #2980b9;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #f0f0f0;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 14px;
      color: #555;
    }
    .input-wrapper {
      position: relative;
    }
    .input-wrapper i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #95a5a6;
      transition: color 0.3s;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 12px 12px 12px 40px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      background-color: #fdfdfd;
    }
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.15);
    }
    .form-group input:focus + i {
        color: #3498db;
    }
    .dms-group {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 90px;
      gap: 10px;
    }
    .dms-group input, .dms-group select {
      padding: 12px;
      text-align: center;
    }
    #coord-format-toggle {
      margin-bottom: 25px;
      display: flex;
      gap: 10px;
      background-color: #ecf0f1;
      padding: 5px;
      border-radius: 8px;
    }
    #coord-format-toggle label {
      flex: 1;
      text-align: center;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s, color 0.3s;
    }
    #coord-format-toggle input[type="radio"] {
      display: none;
    }
    #coord-format-toggle input[type="radio"]:checked + label {
      background-color: #fff;
      color: #3498db;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .converter-box button {
      background: #27ae60;
      color: #fff;
      border: none;
      padding: 14px 20px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 15px rgba(39, 174, 96, 0.2);
    }
    .converter-box button:hover {
      background: #229954;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(39, 174, 96, 0.3);
    }
    .converter-box button:active {
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(39, 174, 96, 0.2);
    }
    .result-box {
      margin-top: 25px;
      padding: 10px 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 5px solid #3498db;
      min-height: 60px;
      color: #333;
      transition: background-color 0.3s;
      font-size: 14px;
    }
    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #e9ecef;
      word-break: break-all;
    }
    .result-item:last-child {
      border-bottom: none;
    }
    .result-label {
      font-weight: 600;
      color: #555;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
      margin-right: 15px;
    }
    .result-value {
      text-align: right;
    }
    .result-value a {
        color: #2980b9;
        font-weight: 600;
        text-decoration: none;
    }
    .result-value a:hover {
        text-decoration: underline;
    }
    .copy-icon {
      cursor: pointer;
      color: #7f8c8d;
      margin-left: 10px;
      transition: color 0.2s, transform 0.2s;
    }
    .copy-icon:hover {
      color: #3498db;
      transform: scale(1.2);
    }
    #map {
      height: 480px;
      width: 100%;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      z-index: 1;
    }
    .hidden {
      display: none;
    }

    /* --- IMPROVED RADIO PLAYER STYLES --- */
    #radio {
        max-width: 1200px;
        margin: 0 auto;
    }
    .region-title {
        font-size: 24px;
        font-weight: 600;
        color: #2c3e50;
        margin-top: 40px;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e0e0e0;
        text-align: left;
    }
    .station-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
    }
    .station {
        background: #fff;
        border: 1px solid #0aa1b1;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
    }
    .station:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(52, 152, 219, 0.15);
        border-color: #3498db;
    }
    .station-info {
        flex-grow: 1;
        min-width: 0; /* Prevents text from overflowing */
    }
    .station-name {
        font-weight: 600;
        font-size: 16px;
        color: #34495e;
        margin: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .station-frequency {
        font-size: 14px;
        color: #7f8c8d;
        margin: 4px 0 0;
    }
    .station-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .play-pause-btn {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: none;
        background-color: #ecf0f1;
        color: #7f8c8d;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: background-color 0.3s, color 0.3s;
        flex-shrink: 0;
        font-size: 18px; /* For FontAwesome icons */
    }
    .play-pause-btn:hover {
        background-color: #e0e6e8;
        color: #3498db;
    }
    .play-pause-btn .fa-play { display: block; margin-left: 3px; }
    .play-pause-btn .fa-pause, .play-pause-btn .radio-loader { display: none; }

    /* Loading state */
    .station.loading .play-pause-btn .fa-play,
    .station.loading .play-pause-btn .fa-pause {
        display: none;
    }
    .station.loading .play-pause-btn .radio-loader {
        display: block;
    }
    .radio-loader {
        width: 20px;
        height: 20px;
        border: 3px solid #bdc3c7;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    /* Playing state */
    .station.playing {
      border-color: #3498db;
      box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1), 0 8px 25px rgba(52, 152, 219, 0.15);
    }
    .station.playing .play-pause-btn {
        background-color: #e74c3c;
        color: #fff;
    }
    .station.playing .play-pause-btn:hover {
        background-color: #c0392b;
    }
    .station.playing .play-pause-btn .fa-play { display: none; }
    .station.playing .play-pause-btn .fa-pause { display: block; }

    .visualizer {
        display: none; /* Hidden by default */
        align-items: flex-end;
        justify-content: space-between;
        width: 28px;
        height: 24px;
    }
    .station.playing .visualizer {
      display: flex; /* Shown only when playing */
    }
    .visualizer span {
        width: 4px;
        height: 10%;
        background-color: #bdc3c7;
        display: block;
        border-radius: 2px;
        animation: visualize 1.2s infinite ease-in-out alternate;
    }
    .visualizer span:nth-child(2) { animation-delay: 0.2s; }
    .visualizer span:nth-child(3) { animation-delay: 0.4s; }
    .visualizer span:nth-child(4) { animation-delay: 0.6s; }
    
    @keyframes visualize {
        from { height: 10%; background-color: #3498db; }
        to { height: 100%; background-color: #e74c3c; }
    }


    /* --- Dark Mode Styles --- */
    .dark .topbar-container .scroll-btn { background: #1e1e1e; color: #e0e0e0; }
    .dark .topbar-container .scroll-btn:hover { background: #2a2a2a; }
    .dark .topbar { background: #1e1e1e; }
    .dark .news-item, .dark .news-content { background: #1e1e1e; }
    .dark .news-title, .dark .description-full,  .dark .description-short { color: #ffffff; }
    .dark .section1 h2, .dark .section h2, .dark .news-title a:hover { color: #90caf9; }
    .dark .section1 p, .dark .meta { color: #aaa; }
    .dark .twitter-link-item { background: #1e1e1e; box-shadow: 0 2px 8px rgba(0,0,0,0.3); color: #1DA1F2; }
    
    .dark #gps h2::after { background: #90caf9; }
    .dark .converter-box { background: #1e1e1e; border-color: #333; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2); }
    .dark .converter-box:hover { box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3); }
    .dark .converter-box h3 { color: #90caf9; border-bottom-color: #2a2a2a; }
    .dark .form-group label { color: #ccc; }
    .dark .form-group input, .dark .form-group select { background: #2a2a2a; border-color: #444; color: #e0e0e0; }
    .dark .form-group input:focus, .dark .form-group select:focus { border-color: #90caf9; box-shadow: 0 0 0 4px rgba(144, 202, 249, 0.15); }
    .dark .form-group input:focus + i { color: #90caf9; }
    .dark .input-wrapper i { color: #666; }
    .dark #coord-format-toggle { background-color: #2c2c2c; }
    .dark #coord-format-toggle label { color: #aaa; }
    .dark #coord-format-toggle input[type="radio"]:checked + label { background-color: #1e1e1e; color: #90caf9; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
    .dark .result-box { background: #2a2a2a; border-left-color: #90caf9; color: #e0e0e0; }
    .dark .result-item { border-bottom-color: #2c2c2c; }
    .dark .result-label { color: #bbb; }
    .dark .result-value a { color: #90caf9; }
    .dark .copy-icon { color: #888; }
    .dark .copy-icon:hover { color: #90caf9; }
    .dark .leaflet-tile-pane { filter: invert(1) hue-rotate(180deg); }

    /* Dark Mode for Improved Radio */
    .dark .region-title { color: #90caf9; border-bottom-color: #333; }
    .dark .station { background: #1e1e1e; border-color: #333; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    .dark .station:hover { border-color: #90caf9; box-shadow: 0 8px 25px rgba(144, 202, 249, 0.15); }
    .dark .station-name { color: #e0e0e0; }
    .dark .station-frequency { color: #888; }
    .dark .play-pause-btn { background-color: #2a2a2a; color: #aaa; }
    .dark .play-pause-btn:hover { background-color: #313131; color: #90caf9; }
    .dark .radio-loader { border-color: #555; border-top-color: #90caf9; }
    .dark .station.playing { border-color: #f48fb1; box-shadow: 0 0 0 4px rgba(244, 143, 177, 0.1), 0 8px 25px rgba(244, 143, 177, 0.15); }
    .dark .station.playing .play-pause-btn { background-color: #f48fb1; color: #121212; }
    .dark .station.playing .play-pause-btn:hover { background-color: #f06292; }


    /* --- MOBILE RESPONSIVE STYLES --- */
    @media (max-width: 992px) {
      #gps-container { grid-template-columns: 1fr; gap: 30px; }
    }
    @media (max-width: 768px) {
      header { flex-direction: column; }
      header img { margin-right: 0; margin-bottom: 10px; }
      nav { justify-content: flex-end; padding: 5px 15px; }
      .hamburger { display: block; }
      .nav-links { display: none; position: absolute; top: 100%; left: 0; right: 0; width: 100%; background-color: #2c3e50; flex-direction: column; align-items: flex-start; box-shadow: 0 4px 5px rgba(0,0,0,0.2); z-index: 100; animation: fadeIn 0.3s ease-out; }
      .nav-links.active { display: flex; }
      .nav-links button { width: 100%; justify-content: flex-start; padding: 15px 25px; border-bottom: 1px solid #34495e; }
      .nav-links button:last-child { border-bottom: none; }
      .news-item { flex-direction: column; }
      .news-image { width: 100%; height: 180px; }
      .topbar-container { position: relative; top: auto; }
      main { padding: 20px 15px; }
      .header-text h1 { font-size: 22px; }
      .header-text h2 { font-size: 16px; }
      .section1 h2, .section h2 { font-size: 24px; }
      .section1 p { font-size: 16px; }
      .news-title { font-size: 18px; }
      .dms-group { grid-template-columns: 1fr 1fr 1fr 80px; }
    }
    @media (min-width: 769px) {
        .scroll-btn { display: block; }
        .topbar { border-radius: 0; }
    }
    .toggle-theme { position: fixed; bottom: 20px; right: 20px; background: #3498db; color: white; padding: 10px 16px; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 101; }
  </style>
</head>
<body>

  <header>
    <img src="osint.png" alt="Logo" />
    <div class="header-text">
      <h1>Pakistan News</h1>
      <h2>OSINT Dashboard</h2>
    </div>
  </header>

  <nav>
    <button class="hamburger" aria-label="Toggle Navigation">
      <i class="fas fa-bars"></i>
    </button>
    <div class="nav-links">
      <button onclick="showSection('home')"><i class="fas fa-home"></i> Home</button>
      <button onclick="showNewsSection()"><i class="fas fa-newspaper"></i> News</button>
      <button onclick="showSection('radio')"><i class="fas fa-broadcast-tower"></i> Radio</button>
      <button onclick="showSection('gps')"><i class="fas fa-map-marker-alt"></i> GPS</button>
      <button onclick="window.open('https://cyniq.in', '_blank')"><i class="fas fa-user-secret"></i> Cynic</button>
      <button onclick="window.open('https://cface.ai', '_blank')"><i class="fas fa-robot"></i> CFace</button>
      <button onclick="showSection('twitter')"><i class="fab fa-twitter"></i> Twitter</button>
    </div>
  </nav>

  <main>
    <section id="home" class="section1 active1">
      <h2>Welcome to the OSINT Dashboard</h2>
      <p>Monitor English-language news, radio, and more across Pakistan.</p>
    </section>

    <section id="news" class="section">
       <div class="topbar-container">
        <button class="scroll-btn left" onclick="scrollTopbar('left')"><i class="fas fa-chevron-left"></i></button>
        <div class="topbar" id="topbar">
          <button onclick="loadFeed('dawn')"><i class="fas fa-feather-alt"></i> Dawn</button>
          <button onclick="loadFeed('news')"><i class="fas fa-bullhorn"></i> The News</button>
          <button onclick="loadFeed('dailytimes')"><i class="fas fa-clock"></i> Daily Times</button>
          <button onclick="loadFeed('today')"><i class="fas fa-calendar-day"></i> Pakistan Today</button>
          <button onclick="loadFeed('nation')"><i class="fas fa-flag"></i> The Nation</button>
          <button onclick="loadFeed('bol')"><i class="fas fa-tv"></i> BOL</button>
          <button onclick="loadFeed('geo')"><i class="fas fa-globe-asia"></i> Geo</button>
          <button onclick="loadFeed('khybermail')"><i class="fas fa-envelope-open-text"></i> Khyber Mail</button>
          <button onclick="loadFeed('urdupoint')"><i class="fas fa-broadcast-tower"></i> UrduPoint</button>
          <button onclick="loadFeed('balochistan')"><i class="fas fa-cogs"></i> Balochistan Post</button>
          <button onclick="loadFeed('khyberchronicle')"><i class="fas fa-file-alt"></i> Khyber Chronicles</button>
          <button onclick="loadFeed('pakobserver')"><i class="fas fa-globe"></i> Pak Observer</button>
	        <button onclick="loadFeed('ary')"><i class="fas fa-satellite-dish"></i> ARY News</button>
          <button onclick="loadFeed('app')"><i class="fas fa-cogs"></i> APP</button>
          <button onclick="loadFeed('business_recorder')"><i class="fas fa-chart-bar"></i> Business Recorder</button>
	        <button onclick="loadFeed('frontier_post')"><i class="fas fa-map-marked-alt"></i> Frontier Post</button>
	        <button onclick="loadFeed('hamariweb_en')"><i class="fas fa-desktop"></i> Hamariweb Eng</button>
   	      <button onclick="loadFeed('propakistani')"><i class="fas fa-mobile-alt"></i> ProPakistani</button>
        </div>
        <button class="scroll-btn right" onclick="scrollTopbar('right')"><i class="fas fa-chevron-right"></i></button>
      </div>
      <div class="loader" id="loader" style="display:none;">
        <div class="spinner"></div>
        <p>Loading news...</p>
      </div>
      <div id="news-container"></div>
    </section>

    <section id="radio" class="section">
      <!-- Radio player will be dynamically generated here -->
    </section>

    <section id="gps" class="section">
      <h2><i class="fas fa-crosshairs"></i> GPS Toolkit</h2>
      <div id="gps-container">
        <div class="converter-box">
          <h3><i class="fas fa-map-pin"></i> Coordinates to Address</h3>
           <div id="coord-format-toggle">
            <input type="radio" name="coord-format" value="dd" id="format-dd" checked>
            <label for="format-dd">Decimal</label>
            <input type="radio" name="coord-format" value="dms" id="format-dms">
            <label for="format-dms">DMS</label>
          </div>
          <div id="dd-inputs">
            <div class="form-group">
              <label for="lat-dd">Latitude</label>
              <div class="input-wrapper">
                <input type="number" id="lat-dd" placeholder="e.g., 33.6844">
                <i class="fas fa-globe-asia"></i>
              </div>
            </div>
            <div class="form-group">
              <label for="lon-dd">Longitude</label>
              <div class="input-wrapper">
                <input type="number" id="lon-dd" placeholder="e.g., 73.0479">
                <i class="fas fa-globe-asia"></i>
              </div>
            </div>
          </div>
          <div id="dms-inputs" class="hidden">
            <div class="form-group">
              <label>Latitude</label>
              <div class="dms-group">
                <input type="number" id="lat-deg" placeholder="Deg°">
                <input type="number" id="lat-min" placeholder="Min'">
                <input type="number" id="lat-sec" placeholder="Sec"">
                <select id="lat-dir"><option value="N">N</option><option value="S">S</option></select>
              </div>
            </div>
            <div class="form-group">
              <label>Longitude</label>
              <div class="dms-group">
                <input type="number" id="lon-deg" placeholder="Deg°">
                <input type="number" id="lon-min" placeholder="Min'">
                <input type="number" id="lon-sec" placeholder="Sec"">
                <select id="lon-dir"><option value="E">E</option><option value="W">W</option></select>
              </div>
            </div>
          </div>
          <button onclick="convertCoordsToAddress()"><i class="fas fa-sync-alt"></i> Get Address</button>
          <div class="result-box" id="address-result">Address will appear here...</div>
        </div>
        <div class="converter-box">
          <h3><i class="fas fa-search-location"></i> Address to Coordinates</h3>
          <div class="form-group">
            <label for="address-input">Enter Address or Place Name</label>
            <div class="input-wrapper">
              <input type="text" id="address-input" placeholder="e.g., Faisal Mosque, Islamabad">
              <i class="fas fa-map-marked-alt"></i>
            </div>
          </div>
          <button onclick="convertAddressToCoords()"><i class="fas fa-sync-alt"></i> Get Coordinates</button>
          <div class="result-box" id="coords-result">Coordinates will appear here...</div>
        </div>
      </div>
      <div id="map"></div>
    </section>

    <section id="twitter" class="section">
      <h2><i class="fab fa-twitter"></i> Twitter OSINT Sources</h2>
      <div id="twitter-accounts"></div>
    </section>
  </main>

  <button class="toggle-theme" onclick="toggleTheme()">
    🌓 Theme
  </button>
  
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script>
    const feeds = {
      dawn: 'https://www.dawn.com/feeds/home', news: 'https://www.thenews.com.pk/rss/1/1', dailytimes: 'https://dailytimes.com.pk/feed/',
      today: 'https://www.pakistantoday.com.pk/feed/', nation: 'https://nation.com.pk/rss/national', bol: 'https://www.bolnews.com/feed/',
      geo: 'https://www.geo.tv/rss/1/1', khybermail: 'https://thekhybermail.com/feed/', urdupoint: 'https://www.urdupoint.com/en/sitemap/news.rss',
      balochistan: 'https://thebalochistanpost.net/feed/', khyberchronicle: 'https://khyberchronicles.pk/feed/', pakobserver: 'https://pakobserver.net/feed/',
      ary: 'https://arynews.tv/en/feed/', app: 'https://www.app.com.pk/feed/', business_recorder: 'https://www.brecorder.com/feed/',
      frontier_post: 'https://thefrontierpost.com/feed/', hamariweb_en: 'https://www.hamariweb.com/news/rss/news_rss.aspx', propakistani: 'https://propakistani.pk/feed',
    };

    // --- Radio Station Data ---
    const radioData = {
    "Islamabad": [
        { name: "Saut-ul-Quran", freq: "Quran Channel", url: "https://whmsonic.radio.gov.pk:7002/stream?type=http&nocache=12" },
        { name: "FM 101 Islamabad", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:7008/stream?type=http&nocache=12" },
        { name: "Planet FM 87.6", freq: "87.6 MHz", url: "https://whmsonic.radio.gov.pk:7042/stream?type=http&nocache=12" },
        { name: "Islamabad Station", freq: "Live Stream", url: "https://whmsonic.radio.gov.pk:7003/stream?type=http&nocache=12" },
        { name: "NCAC", freq: "National Channel", url: "https://whmsonic.radio.gov.pk:7004/stream?type=http&nocache=12" },
        { name: "World Service", freq: "English Service", url: "https://whmsonic.radio.gov.pk:7005/stream?type=http&nocache=12" },
        { name: "External Service", freq: "Global Stream", url: "https://whmsonic.radio.gov.pk:7006/stream?type=http&nocache=12" },
        { name: "Sports & Health Channel", freq: "Thematic Channel", url: "https://whmsonic.radio.gov.pk:7007/stream?type=http&nocache=12" },
        { name: "Technology channel", freq: "Thematic Channel", url: "https://whmsonic.radio.gov.pk:8094/stream?type=http&nocache=12" },
        { name: "Chalte Chalte", freq: "Classic Hits", url: "https://whmsonic.radio.gov.pk:7008/stream?type=http&nocache=12" },
        { name: "Environment", freq: "Thematic Channel", url: "https://whmsonic.radio.gov.pk:8102/stream?type=http&nocache=12" },
        { name: "Health", freq: "Thematic Channel", url: "https://whmsonic.radio.gov.pk:7000/Health" },
        { name: "Kids", freq: "Thematic Channel", url: "https://whmsonic.radio.gov.pk:7000/Kids" },
        { name: "Suno FM", freq: "89.4 MHz", url: "https://stream-160.zeno.fm/kugzam6xkypvv" }
    ],
    "Punjab": [
        { name: "FM 101 Bahawalpur", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8020/relay?type=http&nocache=9" },
        { name: "MW Bahawalpur", freq: "Medium Wave", url: "https://whmsonic.radio.gov.pk:8092/relay?type=http&nocache=9" },
        { name: "FM 93 Faisalabad", freq: "93.0 MHz", url: "https://whmsonic.radio.gov.pk:8022/relay?type=http&nocache=9" },
        { name: "FM 101 Faisalabad", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8024/relay?type=http&nocache=9" },
        { name: "FM 93 Lahore", freq: "93.0 MHz", url: "https://whmsonic.radio.gov.pk:8088/stream?type=http&nocache=4" },
        { name: "FM 101 Lahore", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:7000/101lahore" },
        { name: "Lahore MW", freq: "Medium Wave", url: "https://whmsonic.radio.gov.pk:8026/relay?type=http&nocache=9" },
        { name: "FM 93 Mianwali", freq: "93.0 MHz", url: "https://whmsonic.radio.gov.pk:8028/relay?type=http&nocache=9" },
        { name: "FM 93 Multan", freq: "93.0 MHz", url: "https://whmsonic.radio.gov.pk:7014/stream?type=http&nocache=12" },
        { name: "FM 101 Multan", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8032/stream?type=http&nocache=12" },
        { name: "Multan MW", freq: "Medium Wave", url: "https://whmsonic.radio.gov.pk:8034/stream?type=http&nocache=12" },
        { name: "FM 93 Rawalpindi", freq: "93.0 MHz", url: "https://whmsonic.radio.gov.pk:8036/relay?type=http&nocache=9" },
        { name: "FM 101 Sialkot", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8038/relay?type=http&nocache=9" },
        { name: "FM 101 Sargodha", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8040/relay?type=http&nocache=9" }
    ],
    "Sindh": [
        { name: "Hyderabad MW", freq: "1008 KHz", url: "https://whmsonic.radio.gov.pk:8042/stream?type=http&nocache=12" },
        { name: "FM 101 Hyderabad", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8044/stream?type=http&nocache=12" },
        { name: "FM 101 Karachi", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8048/stream?type=http&nocache=12" },
        { name: "FM 93 Karachi", freq: "93.0 MHz", url: "https://whmsonic.radio.gov.pk:7022/stream?type=http&nocache=12" },
        { name: "FM 101 Larkana", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8050/stream?type=http&nocache=12" },
        { name: "FM 101 Mithi", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8052/stream?type=http&nocache=12" },
        { name: "FM 101 Khairpur", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8054/stream?type=http&nocache=12" },
        { name: "MW Karachi", freq: "639 KHz", url: "https://whmsonic.radio.gov.pk:7000/MW639khi?type=http&nocache=9" },
        { name: "FM 101.4 Bhitshah", freq: "101.4 MHz", url: "https://whmsonic.radio.gov.pk:8098/stream?type=http&nocache=12" }
    ],
    "Balochistan": [
        { name: "FM 101 Quetta", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8058/stream?type=http&nocache=12" },
        { name: "Quetta MW", freq: "Medium Wave", url: "https://whmsonic.radio.gov.pk:8060/relay?type=http&nocache=9" },
        { name: "Khuzdar MW", freq: "567 KHz", url: "https://whmsonic.radio.gov.pk:8062/stream?type=http&nocache=12" }
    ],
     "Khyber Pakhtunkhwa": [
    { name: "FM 101 Peshawar", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8070/relay?type=http&nocache=9" },
    { name: "Peshawar MW", freq: "Medium Wave", url: "https://whmsonic.radio.gov.pk:8072/relay?type=http&nocache=9" },
    { name: "FM 101 Kohat", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8068/relay?type=http&nocache=9" },
    { name: "FM 101 Abbotabad", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8064/relay?type=http&nocache=9" },
    { name: "FM 93 Chitral", freq: "93.0 MHz", url: "https://whmsonic.radio.gov.pk:8066/relay?type=http&nocache=9" },
    { name: "D.I. Khan MW", freq: "711 KHz", url: "https://whmsonic.radio.gov.pk:7000/Dikhan?type=http&nocache=9" }
  ],
  "Azad Jammu & Kashmir": [
    { name: "FM 101 Mirpur", freq: "101.0 MHz", url: "https://whmsonic.radio.gov.pk:8078/relay?type=http&nocache=9" },
    { name: "AK‑RADIO‑Tarakhel", freq: "Live Stream", url: "https://whmsonic.radio.gov.pk:8076/relay?type=http&nocache=9" },
    { name: "FM 93 Muzaffarabad", freq: "93.0 MHz", url: "https://whmsonic.radio.gov.pk:8070/93muzaffarabad?type=http&nocache=9" },
    { name: "Azad Kashmir Radio Mirpur", freq: "Live Stream", url: "https://whmsonic.radio.gov.pk:8074?type=http&nocache=9" }
  ],
  "Gilgit-Baltistan": [
    { name: "Gilgit MW", freq: "1512 KHz", url: "https://whmsonic.radio.gov.pk:8082/relay?type=http&nocache=9" }
  ]
};


    let map;
    let marker;
    let mapInitialized = false;

    function showSection(id) {
      document.querySelectorAll('.section, .section1').forEach(s => s.classList.remove('active', 'active1'));
      const section = document.getElementById(id);
      section.classList.add(id === 'home' ? 'active1' : 'active');

      if (id === 'gps' && !mapInitialized) {
        initMap();
        mapInitialized = true;
      }
    }
    
    function showNewsSection() {
        showSection('news');
        const lastFeed = localStorage.getItem('lastFeed');
        if (lastFeed && !document.querySelector('.topbar button.active')) {
            loadFeed(lastFeed, false); // Don't steal focus on auto-load
        }
    }


    function toggleReadMore(idx) {
      const shortEl = document.getElementById(`short-${idx}`);
      const fullEl = document.getElementById(`full-${idx}`);
      const btn = document.getElementById(`btn-${idx}`);
      if (fullEl.style.display === 'block') {
        fullEl.style.display = 'none'; shortEl.style.display = 'block'; btn.textContent = 'Read more';
      } else {
        fullEl.style.display = 'block'; shortEl.style.display = 'none'; btn.textContent = 'Show less';
      }
    }

    function loadFeed(source, shouldActivate = true) {
      const container = document.getElementById('news-container');
      const loader = document.getElementById('loader');
      
      if(shouldActivate){
        const buttons = document.querySelectorAll('.topbar button');
        buttons.forEach(button => button.classList.remove('active'));
        const activeButton = document.querySelector(`.topbar button[onclick="loadFeed('${source}')"]`);
        if (activeButton) activeButton.classList.add('active');
      }

      container.innerHTML = '';
      loader.style.display = 'block';
      localStorage.setItem('lastFeed', source);

      fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feeds[source])}`)
        .then(r => r.json())
        .then(data => {
          loader.style.display = 'none';
          if (!data.items?.length) { container.innerHTML = '<p>No news found.</p>'; return; }
          data.items.slice(0, 15).forEach((item, idx) => {
            const pubDate = new Date(item.pubDate).toLocaleString('en-IN', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', timeZone: 'Asia/Kolkata', hour12: true });
            const imgMatch = item.description.match(/<img.*?src="(.*?)"/);
            const imageUrl = imgMatch ? imgMatch[1] : null;
            const shareUrl = `https://wa.me/?text=${encodeURIComponent(item.title + ' - ' + item.link)}`;
            const imgTag = imageUrl ? `<img src="${imageUrl}" class="news-image" alt="" onerror="this.onerror=null;this.src='https://via.placeholder.com/400x200?text=No+Image';"/>` : `<img src="https://via.placeholder.com/400x200?text=No+Image" class="news-image" alt=""/>`;
            const fullText = (item.content || item.description).replace(/<[^>]+>/g, '').trim();
            container.innerHTML += `
              <div class="news-item">
                ${imgTag}
                <div class="news-content">
                  <h3 class="news-title"><a href="${item.link}" target="_blank">${item.title}</a></h3>
                  <div class="meta"><i class="fas fa-clock"></i> ${pubDate} (IST)</div>
                  <p id="short-${idx}" class="description-short">${fullText.substring(0, 250)}…</p>
                  <p id="full-${idx}" class="description-full">${fullText}</p>
                  <div class="news-footer">
                    <button id="btn-${idx}" class="read-more" onclick="toggleReadMore(${idx})">Read more</button>
                    <a href="${item.link}" target="_blank" class="source-btn"><i class="fas fa-link"></i> Source</a>
                    <a href="${shareUrl}" target="_blank" class="share-btn" title="Share on WhatsApp"><i class="fab fa-whatsapp"></i></a>
                  </div>
                </div>
              </div>`;
          });
        })
        .catch(err => {
          loader.style.display = 'none';
          container.innerHTML = `<p>Error loading news: ${err.message}</p>`;
          console.error("Feed loading error:", err);
        });
    }

    // --- Radio Player Builder and Controls ---
    let audioPlayer = null;
    let currentPlayingStation = null;
    let audioContext, analyser, source;
    let isAudioContextInitialized = false;

    function buildRadioPlayer() {
        const radioContainer = document.getElementById('radio');
        if (!radioContainer) return;

        let html = ``;
        
        for (const region in radioData) {
            html += `<h2 class="region-title">${region}</h2>`;
            html += `<div class="station-grid">`;
            radioData[region].forEach(station => {
                html += `
                    <div class="station" data-stream-url="${station.url}">
                        <div class="station-info">
                            <p class="station-name">${station.name}</p>
                            <p class="station-frequency">${station.freq}</p>
                        </div>
                        <div class="station-controls">
                            <div class="visualizer"><span></span><span></span><span></span><span></span></div>
                            <button class="play-pause-btn" aria-label="Play ${station.name}">
                                <i class="fas fa-play"></i>
                                <i class="fas fa-pause"></i>
                                <div class="radio-loader"></div>
                            </button>
                        </div>
                    </div>
                `;
            });
            html += `</div>`;
        }
        
        html += `<audio id="radio-audio-player" crossorigin="anonymous" preload="none"></audio>`;
        radioContainer.innerHTML = html;
        
        // After building the player, set up the controls
        setupRadioControls();
    }

    function setupRadioControls() {
        audioPlayer = document.getElementById('radio-audio-player');
        const stations = document.querySelectorAll('.station');

        function initAudioContext() {
            if (isAudioContextInitialized || !audioPlayer) return;
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioContext = new AudioContext();
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 64;
                source = audioContext.createMediaElementSource(audioPlayer);
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                isAudioContextInitialized = true;
            } catch (e) {
                console.error("Web Audio API could not be initialized.", e);
            }
        }

        function drawVisualizer() {
            if (!isAudioContextInitialized || !audioPlayer || audioPlayer.paused || !currentPlayingStation) return;
            requestAnimationFrame(drawVisualizer);
            
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);

            const visualizerBars = currentPlayingStation.querySelectorAll('.visualizer span');
            const barCount = visualizerBars.length;
            
            for(let i = 0; i < barCount; i++) {
                const barHeight = Math.pow(dataArray[i * 2] / 255, 2.5) * 100;
                visualizerBars[i].style.height = `${Math.max(5, barHeight)}%`;
            }
        }

        stations.forEach(station => {
            const playButton = station.querySelector('.play-pause-btn');
            playButton.addEventListener('click', (e) => {
                e.stopPropagation();
                initAudioContext();

                if (currentPlayingStation === station && !audioPlayer.paused) {
                    audioPlayer.pause();
                    return;
                }

                if (currentPlayingStation) {
                    currentPlayingStation.classList.remove('playing', 'loading');
                }
                stations.forEach(s => s.classList.remove('playing', 'loading'));

                station.classList.add('loading');
                currentPlayingStation = station;

                audioPlayer.src = station.dataset.streamUrl;
                audioPlayer.play().then(() => {
                    station.classList.remove('loading');
                    station.classList.add('playing');
                    drawVisualizer();
                }).catch(err => {
                    console.error("Failed to play audio:", err);
                    station.classList.remove('loading');
                    currentPlayingStation = null;
                    alert('Could not play the selected station.');
                });
            });
        });

        audioPlayer.onpause = () => {
            if (currentPlayingStation) {
                currentPlayingStation.classList.remove('playing', 'loading');
                const visualizerBars = currentPlayingStation.querySelectorAll('.visualizer span');
                visualizerBars.forEach(bar => bar.style.height = '10%');
                currentPlayingStation = null;
            }
        };
    }

    // --- GPS and Map Functions ---
    function initMap() {
      map = L.map('map').setView([30.3753, 69.3451], 5);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);
    }

    function updateMapView(lat, lon, popupText) {
      if (marker) map.removeLayer(marker);
      marker = L.marker([lat, lon]).addTo(map).bindPopup(popupText).openPopup();
      map.setView([lat, lon], 13);
    }

    function copyToClipboard(text, el) {
        navigator.clipboard.writeText(text).then(() => {
            const originalIcon = el.className;
            el.className = 'fas fa-check copy-icon';
            setTimeout(() => {
                el.className = originalIcon;
            }, 1500);
        }).catch(err => {
            console.error('Failed to copy text: ', err);
            alert('Failed to copy');
        });
    }

    function dmsToDd(d, m, s, direction) {
      let dd = parseFloat(d) + parseFloat(m)/60 + parseFloat(s)/(60*60);
      if (direction === "S" || direction === "W") dd = dd * -1;
      return dd;
    }

    function ddToDms(lat, lon) {
        const dmsLat = (dd) => {
            const dir = dd < 0 ? 'S' : 'N';
            const absDD = Math.abs(dd);
            const deg = Math.floor(absDD);
            const min = Math.floor((absDD - deg) * 60);
            const sec = (((absDD - deg) * 60 - min) * 60).toFixed(2);
            return `${deg}° ${min}' ${sec}" ${dir}`;
        };
        const dmsLon = (dd) => {
            const dir = dd < 0 ? 'W' : 'E';
            const absDD = Math.abs(dd);
            const deg = Math.floor(absDD);
            const min = Math.floor((absDD - deg) * 60);
            const sec = (((absDD - deg) * 60 - min) * 60).toFixed(2);
            return `${deg}° ${min}' ${sec}" ${dir}`;
        };
        return {
            lat: dmsLat(lat),
            lon: dmsLon(lon)
        };
    }

    async function convertCoordsToAddress() {
      const format = document.querySelector('input[name="coord-format"]:checked').value;
      let lat, lon;
      const resultBox = document.getElementById('address-result');
      resultBox.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Converting...';

      try {
          if (format === 'dd') {
            lat = parseFloat(document.getElementById('lat-dd').value);
            lon = parseFloat(document.getElementById('lon-dd').value);
          } else {
            const latD = document.getElementById('lat-deg').value || 0;
            const latM = document.getElementById('lat-min').value || 0;
            const latS = document.getElementById('lat-sec').value || 0;
            const latDir = document.getElementById('lat-dir').value;
            const lonD = document.getElementById('lon-deg').value || 0;
            const lonM = document.getElementById('lon-min').value || 0;
            const lonS = document.getElementById('lon-sec').value || 0;
            const lonDir = document.getElementById('lon-dir').value;
            lat = dmsToDd(latD, latM, latS, latDir);
            lon = dmsToDd(lonD, lonM, lonS, lonDir);
          }

          if (isNaN(lat) || isNaN(lon)) {
            resultBox.textContent = 'Please provide valid coordinates.';
            return;
          }

          const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
          if (!response.ok) {
            throw new Error(`API request failed with status ${response.status}`);
          }
          const data = await response.json();
          if (data.error) {
            resultBox.textContent = `Error: ${data.error}`;
          } else {
            const apiLat = parseFloat(data.lat);
            const apiLon = parseFloat(data.lon);
            const dmsCoords = ddToDms(apiLat, apiLon);
            const gmapsLink = `https://maps.google.com/?q=${apiLat},${apiLon}`;
            const ddString = `${apiLat.toFixed(6)}, ${apiLon.toFixed(6)}`;
            const dmsString = `${dmsCoords.lat}, ${dmsCoords.lon}`;
            
            resultBox.innerHTML = `
              <div class="result-item">
                <span class="result-label"><i class="fas fa-map-marker-alt"></i> Address</span>
                <span class="result-value">${data.display_name} <i class="fas fa-copy copy-icon" onclick="copyToClipboard('${data.display_name.replace(/'/g, "\\'")}', this)"></i></span>
              </div>
              <div class="result-item">
                <span class="result-label"><i class="fas fa-ruler-combined"></i> Decimal</span>
                <span class="result-value">${ddString} <i class="fas fa-copy copy-icon" onclick="copyToClipboard('${ddString}', this)"></i></span>
              </div>
              <div class="result-item">
                <span class="result-label"><i class="fas fa-compass"></i> DMS</span>
                <span class="result-value">${dmsString} <i class="fas fa-copy copy-icon" onclick="copyToClipboard('${dmsString}', this)"></i></span>
              </div>
              <div class="result-item">
                <span class="result-label"><i class="fab fa-google"></i> Map</span>
                <span class="result-value"><a href="${gmapsLink}" target="_blank">Open Link</a> <i class="fas fa-copy copy-icon" onclick="copyToClipboard('${gmapsLink}', this)"></i></span>
              </div>
            `;
            updateMapView(apiLat, apiLon, data.display_name);
          }
      } catch(e) {
        console.error("Reverse Geocoding Error:", e);
        resultBox.textContent = `Failed to fetch address. Check connection or coordinates.`;
      }
    }

    async function convertAddressToCoords() {
      const address = document.getElementById('address-input').value;
      const resultBox = document.getElementById('coords-result');
      if (!address) { 
        resultBox.textContent = 'Please enter an address.'; 
        return; 
      }
      resultBox.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...';

      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(address)}&format=json&limit=1&countrycodes=pk&addressdetails=1`);
        if (!response.ok) {
          throw new Error(`API request failed with status ${response.status}`);
        }
        const data = await response.json();
        if (data && data.length > 0) {
          const { lat, lon, display_name } = data[0];
          const latNum = parseFloat(lat);
          const lonNum = parseFloat(lon);
          const dmsCoords = ddToDms(latNum, lonNum);
          const gmapsLink = `https://maps.google.com/?q=${latNum},${lonNum}`;
          const ddString = `${latNum.toFixed(6)}, ${lonNum.toFixed(6)}`;
          const dmsString = `${dmsCoords.lat}, ${dmsCoords.lon}`;

          resultBox.innerHTML = `
            <div class="result-item">
              <span class="result-label"><i class="fas fa-map-marker-alt"></i> Found</span>
              <span class="result-value">${display_name} <i class="fas fa-copy copy-icon" onclick="copyToClipboard('${display_name.replace(/'/g, "\\'")}', this)"></i></span>
            </div>
            <div class="result-item">
              <span class="result-label"><i class="fas fa-ruler-combined"></i> Decimal</span>
              <span class="result-value">${ddString} <i class="fas fa-copy copy-icon" onclick="copyToClipboard('${ddString}', this)"></i></span>
            </div>
            <div class="result-item">
              <span class="result-label"><i class="fas fa-compass"></i> DMS</span>
              <span class="result-value">${dmsString} <i class="fas fa-copy copy-icon" onclick="copyToClipboard('${dmsString}', this)"></i></span>
            </div>
            <div class="result-item">
              <span class="result-label"><i class="fab fa-google"></i> Map</span>
              <span class="result-value"><a href="${gmapsLink}" target="_blank">Open Link</a> <i class="fas fa-copy copy-icon" onclick="copyToClipboard('${gmapsLink}', this)"></i></span>
            </div>
          `;
          updateMapView(latNum, lonNum, display_name);
        } else {
          resultBox.textContent = 'Coordinates not found. Please try a more specific address.';
        }
      } catch(e) {
        console.error("Geocoding Error:", e);
        resultBox.textContent = 'Failed to fetch coordinates. Check connection.';
      }
    }

    document.querySelectorAll('input[name="coord-format"]').forEach(radio => {
      radio.addEventListener('change', (e) => {
        if (e.target.value === 'dd') {
          document.getElementById('dd-inputs').classList.remove('hidden');
          document.getElementById('dms-inputs').classList.add('hidden');
        } else {
          document.getElementById('dd-inputs').classList.add('hidden');
          document.getElementById('dms-inputs').classList.remove('hidden');
        }
      });
    });

    // --- General Functions ---
    function toggleTheme() {
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    }

    function setupHamburgerMenu() {
        const hamburger = document.querySelector('.hamburger');
        const navLinks = document.querySelector('.nav-links');
        if (hamburger && navLinks) {
            hamburger.addEventListener('click', () => navLinks.classList.toggle('active'));
            navLinks.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', () => { if (window.innerWidth <= 768) navLinks.classList.remove('active'); });
            });
        }
    }

    function scrollTopbar(direction) {
        const topbar = document.getElementById('topbar');
        const scrollAmount = 300;
        topbar.scrollLeft += (direction === 'left' ? -scrollAmount : scrollAmount);
    }

    function setupTwitterFeeds() {
        const twitterAccounts = [
          'OfficialDGISPR', 'GovtofPakistan', 'pid_gov', 'RadioPakistan', 'ForeignOfficePk', 'sayedzbukhari', 'Asad_Umar', 'fawadchaudhry', 'Bahot_Baluch',
          'BrigAshfaqHasan', 'Conflictpk', 'LeejSimon', 'KabulFrontline', 'zubair_utmanzai', 'Pak_AfgAffairs', 'TracTerrorism', 'PashtunWali79', 'PakistanFauj',
          'khorasandiary', 'AfghanistanNMF', 'spogmai_fm', 'NepCorres', 'north1122_news', 'Waziristan7861', 'elisabethmalom1', 'fpa31', 'TheLegateIN', 'zarrar_11PK',
          'Resonant_News', 'Defense_Talks', 'AGFanOff', 'soldierspeaks', '_AhmedQuraishi', 'RadioactiveFrnd', 'Defence__Pk', 'RealBababanaras', 'dgprPaknavy', 'GDI_Aero',
          'defence_insider', 'InsurgencyWatch', 'ForumStrategic', 'War_Analysts', 'MoDAfghanistan2', 'ModAfghanistan4', 'Helmand215Corps', 'AfgGcpsu', 'Qulordo207alfar',
          'GDI1415', '203mansoricorps', 'markazi313', 'AhmdKhwshh32599', 'AfghanAnalyst2', 'AboZobir5', 'Taliban_times', 'shamssameem313', 'ArianaNews_', 'AFIntlBrk',
          'pashtortanews', 'AtalnRoghtya', 'HafizUmari313', 'bnadari1', 'HafizHelmandy', 'NRFafg', 'AfgFreedomAFF', 'Bashaarafghan', 'Brigade_P_203M', '33443tPBx7HX6VZ'
        ];
        const twitterContainer = document.getElementById('twitter-accounts');
        twitterContainer.innerHTML = '';
        twitterAccounts.forEach(handle => {
          const link = document.createElement('a');
          link.className = 'twitter-link-item';
          link.href = `https://twitter.com/${handle}`;
          link.target = '_blank';
          link.rel = 'noopener noreferrer';
          link.innerHTML = `<i class="fab fa-twitter"></i> <span>${handle}</span>`;
          twitterContainer.appendChild(link);
        });
    }

    window.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');
      setupHamburgerMenu();
      setupTwitterFeeds();
      buildRadioPlayer(); // Dynamically create the radio section
      showSection('home');
      const lastFeed = localStorage.getItem('lastFeed');
      if (lastFeed) {
          const activeButton = document.querySelector(`.topbar button[onclick="loadFeed('${lastFeed}')"]`);
          if (activeButton) activeButton.classList.add('active');
      }
    });
  </script>

</body>
</html>
